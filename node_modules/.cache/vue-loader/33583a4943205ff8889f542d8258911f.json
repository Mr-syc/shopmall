{"remainingRequest":"C:\\Users\\acw\\Desktop\\shopmall\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\acw\\Desktop\\shopmall\\src\\views\\detail\\detail.vue?vue&type=style&index=0&id=ff20c6b6&scoped=true&lang=css&","dependencies":[{"path":"C:\\Users\\acw\\Desktop\\shopmall\\src\\views\\detail\\detail.vue","mtime":1596883103724},{"path":"C:\\Users\\acw\\Desktop\\shopmall\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\acw\\Desktop\\shopmall\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"C:\\Users\\acw\\Desktop\\shopmall\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"C:\\Users\\acw\\Desktop\\shopmall\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\acw\\Desktop\\shopmall\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCiNkZXRhaWx7CiAgcG9zaXRpb246IHJlbGF0aXZlOwogIHotaW5kZXg6IDk7CiAgaGVpZ2h0OiAxMDB2aDsKICBiYWNrZ3JvdW5kLWNvbG9yOiB3aGl0ZTsKfQouZGV0YWlsLW5hdnsKICBwb3NpdGlvbjogcmVsYXRpdmU7CiAgei1pbmRleDogOTsKICBiYWNrZ3JvdW5kLWNvbG9yOiAjZmZmZmZmOwp9CgouY29udGVudHsKICBoZWlnaHQ6IGNhbGMoMTAwJSAtIDQ0cHggLSA0OXB4KTsKfQoKCg=="},{"version":3,"sources":["detail.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAuMA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA","file":"detail.vue","sourceRoot":"src/views/detail","sourcesContent":["<template>\r\n  <div id=\"detail\" >\r\n    <DetailNavBar class=\"detail-nav\" :current-index=\"currentIndex\" @itemClick=\"itemClick\"/>\r\n    <scroll class=\"content\"\r\n            ref=\"scroll\"\r\n            :probe-type=\"3\"\r\n            @scroll=\"contentScroll\">\r\n       <detail-swiper :top-images=\"topImages\"></detail-swiper>\r\n       <Detail-base-info :goods=\"goods\"></Detail-base-info>\r\n       <Detail-shop-info :shop=\"shop\"></Detail-shop-info>\r\n       <Detail-goods-info :detail-info=\"detailInfo\" @imgLoad=\"imageLoad\"></Detail-goods-info>\r\n       <Detail-param-info :param-info=\"paramInfo\" ref=\"params\"></Detail-param-info>\r\n       <DetailCommentInfo :comment-info=\"commentInfo\" ref=\"comment\"></DetailCommentInfo>\r\n       <DetailRecommendInfo :recommend-list=\"recommends\" ref=\"recommend\"></DetailRecommendInfo>\r\n    </scroll>\r\n    <DetailBottomBar @addToCart=\"addCart\" class=\"detail-nav\"></DetailBottomBar>\r\n    <back-top @click.native=\"backClick\" v-show=\"isShow\"></back-top>\r\n    <toast :message='message' :show=\"show\"></toast>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport DetailNavBar from \"./childComps/DetailNavBar\";\r\nimport detailSwiper from \"./childComps/detailSwiper\";\r\nimport DetailBaseInfo from \"./childComps/DetailBaseInfo\";\r\nimport DetailShopInfo from \"./childComps/DetailShopInfo\";\r\nimport DetailGoodsInfo from \"./childComps/DetailGoodsInfo\";\r\nimport DetailParamInfo from \"./childComps/DetailParamInfo\";\r\nimport DetailCommentInfo from \"./childComps/DetailCommentInfo\";\r\nimport DetailRecommendInfo from \"./childComps/DetailRecommendInfo\";\r\nimport DetailBottomBar from \"./childComps/DetailBottomBar\";\r\n\r\n\r\nimport scroll from \"components/common/scroll/scroll\";\r\nimport backTop from \"components/content/backtop/backTop\";\r\nimport toast from \"../../components/common/toast/toast\";\r\n\r\n\r\nimport {getDetail,goods,Shop,GoodsParam,getRecommend} from \"../../network/detail\";\r\nimport {itemListenerMixin,backTopMixin} from \"../../common/mixin\";\r\nimport {debounce} from \"../../common/utils\";\r\n\r\nimport {mapActions} from 'vuex'\r\n\r\nexport default {\r\n  name: \"detail\",\r\n  components:{\r\n    DetailNavBar,\r\n    detailSwiper,\r\n    DetailBaseInfo,\r\n    DetailShopInfo,\r\n    DetailGoodsInfo,\r\n    DetailParamInfo,\r\n    DetailCommentInfo,\r\n    DetailRecommendInfo,\r\n    DetailBottomBar,\r\n    scroll,\r\n    backTop,\r\n    toast,\r\n    },\r\n  data(){\r\n      return {\r\n        id:'',\r\n        topImages:[],\r\n        goods:{},\r\n        shop:{},\r\n        detailImages:[],\r\n        detailInfo:{},\r\n        paramInfo:{},\r\n        commentInfo:{},\r\n        recommends:[],\r\n        itemImgListener:null,\r\n        itemY:[],\r\n        getThemeY:[],\r\n        currentIndex:0,\r\n        shopAdd:{},\r\n        message:'',\r\n        show:false\r\n      }\r\n    },\r\n  created() {\r\n    //1.保存传入的id\r\n    const iid = this.$route.params.iid\r\n    this.id = iid\r\n\r\n    //2.根据id接受数据\r\n    getDetail(iid).then(res => {\r\n      //1.获取顶部的图片轮播图数据\r\n      const data = res.result;\r\n      this.topImages = data.itemInfo.topImages\r\n      console.log(data);\r\n      this.shopAdd = data.itemInfo\r\n\r\n      //2.获取商品信息\r\n      this.goods = new goods(data.itemInfo,data.columns,data.shopInfo.services)\r\n\r\n      //3.创建商品店铺信息\r\n      this.shop = new Shop(data.shopInfo)\r\n\r\n      //4.保存商品的详情信息\r\n      this.detailInfo = data.detailInfo\r\n\r\n      //5.获取参数信息\r\n      this.paramInfo = new GoodsParam(data.itemParams.info,data.itemParams.rule)\r\n\r\n      //6.获取评论信息\r\n      if(data.rate.list){\r\n        this.commentInfo = data.rate.list[0]\r\n      }\r\n    })\r\n\r\n    //3.请求推荐数据\r\n    getRecommend().then( res => {\r\n      // console.log(res);\r\n      this.recommends = res.data.list\r\n    })\r\n\r\n    //4.给getThemeY赋值,对this.themeY赋值的操作进行防抖\r\n    this.getThemeY = debounce(() => {\r\n      this.itemY=[]\r\n      this.itemY.push(0)\r\n      this.itemY.push(this.$refs.params.$el.offsetTop)\r\n      this.itemY.push(this.$refs.comment.$el.offsetTop)\r\n      this.itemY.push(this.$refs.recommend.$el.offsetTop)\r\n      this.itemY.push(Number.MAX_VALUE)\r\n    },100)\r\n\r\n\r\n\r\n  },\r\n\r\n  mounted() {\r\n\r\n  },\r\n  mixins:[itemListenerMixin,backTopMixin],\r\n  methods:{\r\n    ...mapActions({\r\n      add:'addCart'\r\n    }),\r\n    imageLoad(){\r\n      this.refresh()\r\n      this.getThemeY()\r\n    },\r\n    contentScroll(position){\r\n      this.isShow = (-position.y) > 1000\r\n\r\n      const positionY = -position.y\r\n      let length = this.itemY.length\r\n      for(let i=0;i<length-1;i++){\r\n        if(this.currentIndex !==i && (positionY >= this.itemY[i] && positionY< this.itemY[i+1])){\r\n          this.currentIndex = i\r\n          // console.log(this.currentIndex);\r\n        }\r\n      }\r\n    },\r\n    itemClick(index){\r\n      this.$refs.scroll.scrollTo(0,-this.itemY[index],100)\r\n    },\r\n    addCart(){\r\n      //1.获取购物车需要展示的商品信息\r\n      const product = {}\r\n      product.image = this.topImages[0];\r\n      product.title = this.shopAdd.title;\r\n      product.desc = this.shopAdd.desc;\r\n      product.price = this.shopAdd.lowNowPrice;\r\n      product.iid = this.shopAdd.iid;\r\n\r\n\r\n      //2.将商品添加到购物车里面\r\n      // this.add(product).then(res => {\r\n      //   this.show = true\r\n      //   this.message = res\r\n      //\r\n      //   setTimeout(() => {\r\n      //     this.show = false\r\n      //     this.message = ''\r\n      //   },1000)\r\n      // })\r\n      this.add(product).then(res => {\r\n        this.$toast.show(res,2000)\r\n\r\n        console.log(this.$toast);\r\n      })\r\n\r\n\r\n\r\n      // this.$store.dispatch('addCart',product).then(res => {\r\n      //   console.log(res);\r\n      // })\r\n\r\n    }\r\n  },\r\n  destroyed() {\r\n    this.$off('itemImgLoad',this.itemImgListener)\r\n  },\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n  #detail{\r\n    position: relative;\r\n    z-index: 9;\r\n    height: 100vh;\r\n    background-color: white;\r\n  }\r\n  .detail-nav{\r\n    position: relative;\r\n    z-index: 9;\r\n    background-color: #ffffff;\r\n  }\r\n\r\n  .content{\r\n    height: calc(100% - 44px - 49px);\r\n  }\r\n\r\n\r\n</style>\r\n"]}]}